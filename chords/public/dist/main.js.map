{
  "version": 3,
  "sources": ["../../main.tsx"],
  "sourcesContent": ["import { Signal } from \"@char/aftercare\";\n\nconst SHARPS = [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"];\nconst FLATS = [\"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\"];\n\nconst transposeRoot = (root: string, n: number): string => {\n  const scale = root.includes(\"b\") ? FLATS : SHARPS;\n  const idx = scale.indexOf(root);\n  if (idx === -1) return root;\n  return scale[(((idx + n) % 12) + 12) % 12];\n};\n\nconst transposeChord = (chord: string, n: number): string => {\n  if (n === 0) return chord;\n  const match = chord.match(/^([A-G][b#]?)(.*)/);\n  if (!match) return chord;\n  return transposeRoot(match[1], n) + match[2];\n};\n\nconst isChord = (token: string): boolean => /^[A-G][b#]?/.test(token);\n\nconst text = new Signal(\"\");\nconst semitones = new Signal(0);\n\nconst renderChordLine = (line: string): Node[] => {\n  const tokens = line.split(/(\\s+)/);\n  const st = semitones.get();\n  return tokens.map(tok =>\n    isChord(tok) ? (\n      <span class=\"chord-wrap\">\n        <span class=\"chord\">\n          {tok\n            .split(\"/\")\n            .map(r => transposeChord(r, st))\n            .join(\"/\")}\n        </span>\n        {tok}\n      </span>\n    ) : (\n      document.createTextNode(tok)\n    ),\n  );\n};\n\nconst backdrop = (<div class=\"editor-backdrop\" aria-hidden=\"true\" />) as HTMLElement;\n\nconst updateBackdrop = () => {\n  const lines = text.get().split(\"\\n\");\n  const nodes: Node[] = [];\n  for (let i = 0; i < lines.length; i++) {\n    if (i > 0) nodes.push(document.createTextNode(\"\\n\"));\n\n    if (i % 2 === 0) {\n      nodes.push(...renderChordLine(lines[i]));\n    } else {\n      nodes.push(document.createTextNode(lines[i]));\n    }\n  }\n\n  // force the browser to render any trailing newlines. lol\n  nodes.push(document.createTextNode(\"\\u200b\"));\n\n  backdrop.replaceChildren(...nodes);\n};\n\ntext.subscribe(updateBackdrop);\nsemitones.subscribe(updateBackdrop);\n\nconst textarea = (\n  <textarea id=\"input\" spellcheck={false} autocomplete=\"off\" autocorrect={false} value={text} />\n) as HTMLTextAreaElement;\n\ntextarea.addEventListener(\"scroll\", () => {\n  backdrop.scrollTop = textarea.scrollTop;\n});\n\nconst semitonesInput = (\n  <input\n    id=\"semitones\"\n    type=\"number\"\n    min=\"-11\"\n    max=\"11\"\n    value={semitones.str(Number)}\n    placeholder=\"0\"\n  />\n);\n\ndocument.querySelector(\"main\")!.append(\n  <section>transpose by {semitonesInput} semitones:</section>,\n  <div class=\"editor\">\n    {backdrop}\n    {textarea}\n  </div>,\n);\n\nupdateBackdrop();\n"],
  "mappings": "+EAAA,OAAS,UAAAA,MAAc,kBA6BjB,OACE,OAAAC,EADF,QAAAC,MAAA,8BA3BN,IAAMC,EAAS,CAAC,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,GAAG,EACzEC,EAAQ,CAAC,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,GAAG,EAExEC,EAAgBC,EAAA,CAACC,EAAcC,IAAsB,CACzD,IAAMC,EAAQF,EAAK,SAAS,GAAG,EAAIH,EAAQD,EACrCO,EAAMD,EAAM,QAAQF,CAAI,EAC9B,OAAIG,IAAQ,GAAWH,EAChBE,IAASC,EAAMF,GAAK,GAAM,IAAM,EAAE,CAC3C,EALsB,iBAOhBG,EAAiBL,EAAA,CAACM,EAAeJ,IAAsB,CAC3D,GAAIA,IAAM,EAAG,OAAOI,EACpB,IAAMC,EAAQD,EAAM,MAAM,mBAAmB,EAC7C,OAAKC,EACER,EAAcQ,EAAM,CAAC,EAAGL,CAAC,EAAIK,EAAM,CAAC,EADxBD,CAErB,EALuB,kBAOjBE,EAAUR,EAACS,GAA2B,cAAc,KAAKA,CAAK,EAApD,WAEVC,EAAO,IAAIC,EAAO,EAAE,EACpBC,EAAY,IAAID,EAAO,CAAC,EAExBE,EAAkBb,EAACc,GAAyB,CAChD,IAAMC,EAASD,EAAK,MAAM,OAAO,EAC3BE,EAAKJ,EAAU,IAAI,EACzB,OAAOG,EAAO,IAAIE,GAChBT,EAAQS,CAAG,EACTrB,EAAC,QAAK,MAAM,aACV,UAAAD,EAAC,QAAK,MAAM,QACT,SAAAsB,EACE,MAAM,GAAG,EACT,IAAIC,GAAKb,EAAea,EAAGF,CAAE,CAAC,EAC9B,KAAK,GAAG,EACb,EACCC,GACH,EAEA,SAAS,eAAeA,CAAG,CAE/B,CACF,EAlBwB,mBAoBlBE,EAAYxB,EAAC,OAAI,MAAM,kBAAkB,cAAY,OAAO,EAE5DyB,EAAiBpB,EAAA,IAAM,CAC3B,IAAMqB,EAAQX,EAAK,IAAI,EAAE,MAAM;AAAA,CAAI,EAC7BY,EAAgB,CAAC,EACvB,QAASC,EAAI,EAAGA,EAAIF,EAAM,OAAQE,IAC5BA,EAAI,GAAGD,EAAM,KAAK,SAAS,eAAe;AAAA,CAAI,CAAC,EAE/CC,EAAI,IAAM,EACZD,EAAM,KAAK,GAAGT,EAAgBQ,EAAME,CAAC,CAAC,CAAC,EAEvCD,EAAM,KAAK,SAAS,eAAeD,EAAME,CAAC,CAAC,CAAC,EAKhDD,EAAM,KAAK,SAAS,eAAe,QAAQ,CAAC,EAE5CH,EAAS,gBAAgB,GAAGG,CAAK,CACnC,EAjBuB,kBAmBvBZ,EAAK,UAAUU,CAAc,EAC7BR,EAAU,UAAUQ,CAAc,EAElC,IAAMI,EACJ7B,EAAC,YAAS,GAAG,QAAQ,WAAY,GAAO,aAAa,MAAM,YAAa,GAAO,MAAOe,EAAM,EAG9Fc,EAAS,iBAAiB,SAAU,IAAM,CACxCL,EAAS,UAAYK,EAAS,SAChC,CAAC,EAED,IAAMC,EACJ9B,EAAC,SACC,GAAG,YACH,KAAK,SACL,IAAI,MACJ,IAAI,KACJ,MAAOiB,EAAU,IAAI,MAAM,EAC3B,YAAY,IACd,EAGF,SAAS,cAAc,MAAM,EAAG,OAC9BhB,EAAC,WAAQ,0BAAc6B,EAAe,eAAW,EACjD7B,EAAC,OAAI,MAAM,SACR,UAAAuB,EACAK,GACH,CACF,EAEAJ,EAAe",
  "names": ["Signal", "jsx", "jsxs", "SHARPS", "FLATS", "transposeRoot", "__name", "root", "n", "scale", "idx", "transposeChord", "chord", "match", "isChord", "token", "text", "Signal", "semitones", "renderChordLine", "line", "tokens", "st", "tok", "r", "backdrop", "updateBackdrop", "lines", "nodes", "i", "textarea", "semitonesInput"]
}
